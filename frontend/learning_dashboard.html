<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›²ç«¯èª²ç¨‹é€²åº¦</title>
    <link rel="stylesheet" href="../style/dashboard.css">
    <link rel="stylesheet" href="../style/time-display.css">
</head>

<body>
    <div class="progress-container">

        <h2 class="h2">ğŸ“Š é›²ç«¯èª²ç¨‹é€²åº¦</h2>

        <div class="links-group">
            <a href="index.html" class="nav-link">&lt;</a>
            <a href="proj.html" class="nav-link">è®€æ›¸è¨ˆç•«</a>
            <a href="General_subject.html" class="nav-link">è€ƒå¤é¡Œè¨˜éŒ„</a>
            <!-- æ–°å¢æ™‚é–“é¡¯ç¤º<div id="timeDisplayContainer"></div> -->

        </div>
        <div class="overall-stats">
            <div class="stat-card">
                <div class="stat-number" id="total-completed">0</div>
                <div class="stat-label">å·²å®Œæˆå ‚æ•¸</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-lessons">0</div>
                <div class="stat-label">ç¸½å ‚æ•¸</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completion-rate">0%</div>
                <div class="stat-label">å®Œæˆç‡</div>
            </div>
        </div>
        <!-- æ–°å¢å…±åŒç§‘ç›®çµ±è¨ˆ -->
        <div class="subject-stats">
            <h3 class="subject-group-title">å…±åŒç§‘ç›®
                <span class="group-progress" id="common-progress">(0/0å ‚, 0%)</span>
            </h3>
        </div>

        <div class="subject-card" id="chinese-subject-card"></div>

        <div class="subject-card" id="law-subject-card"></div>

        <div class="subject-card" id="constitution-subject-card"></div>

        <div class="subject-card" id="english-subject-card"></div>
        <!-- æ–°å¢å°ˆæ¥­ç§‘ç›®çµ±è¨ˆ -->
        <div class="subject-stats">
            <h3 class="subject-group-title">å°ˆæ¥­ç§‘ç›®
                <span class="group-progress" id="professional-progress">(0/0å ‚, 0%)</span>
            </h3>
        </div>

        <div class="subject-card" id="programming-subject-card"></div>

        <div class="subject-card" id="network-subject-card"></div>

        <div class="subject-card" id="computer-subject-card"></div>

        <div class="subject-card" id="information-management-subject-card"></div>

        <div class="subject-card" id="information-security-subject-card"></div>

    </div>
    <script src="../script/time-display.js"></script>
    <script>
        const subjectData = {
            'chinese': {
                name: 'åœ‹æ–‡ä½œæ–‡ + æ¸¬é©—',
                icon: 'ğŸ“š',
                normalLessons: 5,
                reviewLessons: 4,
                idPrefix: 'chinese'
            },
            'law': {
                name: 'æ³•å­¸ç·’è«–',
                icon: 'âš–ï¸',
                normalLessons: 10,
                reviewLessons: 0,
                idPrefix: 'law'
            },
            'constitution': {
                name: 'æ†²æ³•',
                icon: 'ğŸ›ï¸',
                normalLessons: 9,
                reviewLessons: 0,
                idPrefix: 'constitution'
            },
            'english': {
                name: 'è‹±æ–‡',
                icon: 'ğŸ”¤',
                normalLessons: 7,
                reviewLessons: 0,
                idPrefix: 'english'
            },
            'computer': {
                name: 'è¨ˆç®—æ©Ÿæ¦‚è¦',
                icon: 'ğŸ–¥ï¸',
                normalLessons: 12,
                reviewLessons: 2,
                idPrefix: 'computer'
            },
            'programming': {
                name: 'ç¨‹å¼è¨­è¨ˆæ¦‚è¦',
                icon: 'ğŸ’»',
                normalLessons: 14,
                reviewLessons: 0,
                idPrefix: 'programming'
            },
            'network': {
                name: 'è³‡é€šç¶²è·¯',
                icon: 'ğŸŒ',
                normalLessons: 15,
                reviewLessons: 0,
                idPrefix: 'network'
            },

            'information-management': {
                name: 'è³‡è¨Šç®¡ç† (è³‡æ–™è™•ç†)',
                icon: 'ğŸ“Š',
                normalLessons: 17,
                reviewLessons: 3,
                idPrefix: 'information-management'
            },

            'information-security': {
                name: 'è³‡è¨Šç®¡ç† (è³‡é€šå®‰å…¨)',
                icon: 'ğŸ“Š',
                normalLessons: 14,
                reviewLessons: 0,
                idPrefix: 'information-security'
            }
        };

        const subjectCategories = {
            common: ['chinese', 'law', 'constitution', 'english'],
            professional: ['programming', 'network', 'computer', 'information-management', 'information-security']
        };

        function toggleCollapse(button) {
            const content = button.nextElementSibling;
            const arrow = button.querySelector('.collapse-arrow');

            content.classList.toggle('active');
            arrow.classList.toggle('rotated');
        }

        function createSubjectCard(subjectKey) {
            const data = subjectData[subjectKey];
            const totalLessons = data.normalLessons + data.reviewLessons;

            let html = `
        <button class="collapse-btn" onclick="toggleCollapse(this)">
            <span>${data.icon} ${data.name}</span>
            <div class="progress-info">
                <span class="progress-text">0/${totalLessons}å ‚ (0%)</span>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 0%"></div>
                </div>
                <span class="collapse-arrow">â–¼</span>
            </div>
        </button>
        <div class="collapse-content">
            <div class="lesson-grid">
    `;

            // Add normal lessons
            for (let i = 1; i <= data.normalLessons; i++) {
                html += `
                <div class="lesson-item">
                    <input type="checkbox" id="${data.idPrefix}-${i}" onchange="updateProgress()">
                    <label for="${data.idPrefix}-${i}">ç¬¬${i}å ‚</label>
                </div>
        `;
            }
            html += `</div>`; // Close lesson-grid for normal lessons

            // Add review section if applicable
            if (data.reviewLessons > 0) {
                html += `
            <div class="review-section">
                <div class="review-title">ğŸ“ è€ƒè¡ç­</div>
                <div class="lesson-grid">
        `;
                for (let i = 1; i <= data.reviewLessons; i++) {
                    html += `
                            <div class="lesson-item">
                                <input type="checkbox" id="${data.idPrefix}-review-${i}" onchange="updateProgress()">
                                <label for="${data.idPrefix}-review-${i}">è€ƒè¡ç­${i}</label>
                            </div>
                    `;
                }
                html += `</div></div>`; // Close lesson-grid and review-section
            }

            html += `</div>`; // Close collapse-content

            document.getElementById(`${subjectKey}-subject-card`).innerHTML = html;
        }

        // **æ–°å¢ï¼šå°‡æ‰€æœ‰å‹¾é¸ç‹€æ…‹å„²å­˜åˆ° localStorage çš„å‡½æ•¸**
        function saveStates() {
            const states = {};
            // éæ­·æ‰€æœ‰ checkbox
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                // ä½¿ç”¨ checkbox çš„ ID ä½œç‚º keyï¼Œå®ƒçš„å‹¾é¸ç‹€æ…‹ (true/false) ä½œç‚º value
                states[checkbox.id] = checkbox.checked;
            });
            // å°‡ states ç‰©ä»¶è½‰æ›ç‚º JSON å­—ä¸²ï¼Œä¸¦å„²å­˜åˆ° localStorage
            localStorage.setItem('lessonProgress', JSON.stringify(states));
        }

        // **æ–°å¢ï¼šå¾ localStorage è¼‰å…¥ä¸¦æ‡‰ç”¨å‹¾é¸ç‹€æ…‹çš„å‡½æ•¸**
        function loadSavedStates() {
            // å¾ localStorage å–å¾—åç‚º 'lessonProgress' çš„è³‡æ–™
            const savedStates = localStorage.getItem('lessonProgress');
            if (savedStates) {
                // å¦‚æœæœ‰è³‡æ–™ï¼Œå°‡ JSON å­—ä¸²è§£æå›ç‰©ä»¶
                const states = JSON.parse(savedStates);
                // éæ­·å„²å­˜çš„ç‹€æ…‹ç‰©ä»¶
                for (const id in states) {
                    // æ‰¾åˆ°å°æ‡‰ ID çš„ checkbox å…ƒç´ 
                    const checkbox = document.getElementById(id);
                    // å¦‚æœ checkbox å­˜åœ¨ï¼Œå°±è¨­å®šå®ƒçš„å‹¾é¸ç‹€æ…‹ç‚ºå„²å­˜çš„å€¼
                    if (checkbox) {
                        checkbox.checked = states[id];
                    }
                }
            }
        }

        function updateProgress() {
            // å…ˆæ›´æ–°æ¯å€‹ç§‘ç›®çš„é€²åº¦
            for (const key in subjectData) updateSubjectProgress(key);

            // å†æ›´æ–°ç¸½é«”çµ±è¨ˆæ•¸æ“š
            updateOverallStats();

            // **é‡è¦ï¼šåœ¨æ›´æ–°å®Œæ‰€æœ‰é€²åº¦å¾Œï¼Œå„²å­˜ç•¶å‰çš„å‹¾é¸ç‹€æ…‹**
            saveStates();
        }

        function updateSubjectProgress(subjectKey) {
            const data = subjectData[subjectKey];
            const checkboxes = document.querySelectorAll(`input[id^="${data.idPrefix}-"]`);
            const checked = document.querySelectorAll(`input[id^="${data.idPrefix}-"]:checked`);

            const total = checkboxes.length;
            const completed = checked.length;
            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;

            const subjectCardElement = document.getElementById(`${subjectKey}-subject-card`);
            if (subjectCardElement) {
                const progressText = subjectCardElement.querySelector('.progress-text');
                const progressFill = subjectCardElement.querySelector('.progress-fill');

                if (progressText && progressFill) {
                    progressText.textContent = `${completed}/${total}å ‚ (${percentage}%)`;
                    progressFill.style.width = `${percentage}%`;
                }
            }
        }

        function updateOverallStats() {
            let commonCompleted = 0;
            let commonTotal = 0;
            let professionalCompleted = 0;
            let professionalTotal = 0;

            // è¨ˆç®—å…±åŒç§‘ç›®
            subjectCategories.common.forEach(subjectKey => {
                if (subjectData[subjectKey]) {
                    const checkboxes = document.querySelectorAll(`input[id^="${subjectData[subjectKey].idPrefix}-"]`);
                    const checked = document.querySelectorAll(`input[id^="${subjectData[subjectKey].idPrefix}-"]:checked`);
                    commonTotal += checkboxes.length;
                    commonCompleted += checked.length;
                }
            });

            // è¨ˆç®—å°ˆæ¥­ç§‘ç›®
            subjectCategories.professional.forEach(subjectKey => {
                if (subjectData[subjectKey]) {
                    const checkboxes = document.querySelectorAll(`input[id^="${subjectData[subjectKey].idPrefix}-"]`);
                    const checked = document.querySelectorAll(`input[id^="${subjectData[subjectKey].idPrefix}-"]:checked`);
                    professionalTotal += checkboxes.length;
                    professionalCompleted += checked.length;
                }
            });

            // è¨ˆç®—ç¸½æ•¸å’Œç™¾åˆ†æ¯”
            const totalLessons = commonTotal + professionalTotal;
            const totalCompleted = commonCompleted + professionalCompleted;
            const completionRate = totalLessons > 0 ? Math.round((totalCompleted / totalLessons) * 100) : 0;
            const commonRate = commonTotal > 0 ? Math.round((commonCompleted / commonTotal) * 100) : 0;
            const professionalRate = professionalTotal > 0 ? Math.round((professionalCompleted / professionalTotal) * 100) : 0;

            // æ›´æ–°ç¸½é«”çµ±è¨ˆ
            document.getElementById('total-completed').textContent = totalCompleted;
            document.getElementById('total-lessons').textContent = totalLessons;
            document.getElementById('completion-rate').textContent = `${completionRate}%`;

            // åœ¨ updateOverallStats å‡½æ•¸ä¸­ï¼Œä¿®æ”¹æ›´æ–°åˆ†é¡çµ±è¨ˆçš„éƒ¨åˆ†
            // æ›´æ–°åˆ†é¡çµ±è¨ˆ
            const commonProgress = document.getElementById('common-progress');
            if (commonProgress) {
                let rateClass = '';
                if (commonRate === 100) rateClass = 'complete';
                else if (commonRate >= 80) rateClass = 'high';
                else if (commonRate >= 50) rateClass = 'medium';
                else rateClass = 'low';

                commonProgress.innerHTML = `
        <span class="progress-badge" data-rate="${rateClass}">
            <span class="progress-value">${commonCompleted}/${commonTotal}</span>
            <span class="progress-percent">${commonRate}%</span>
        </span>
    `;
            }

            // å°å°ˆæ¥­ç§‘ç›®åšåŒæ¨£è™•ç†
            const professionalProgress = document.getElementById('professional-progress');
            if (professionalProgress) {
                let rateClass = '';
                if (professionalRate === 100) rateClass = 'complete';
                else if (professionalRate >= 80) rateClass = 'high';
                else if (professionalRate >= 50) rateClass = 'medium';
                else rateClass = 'low';

                professionalProgress.innerHTML = `
        <span class="progress-badge" data-rate="${rateClass}">
            <span class="progress-value">${professionalCompleted}/${professionalTotal}</span>
            <span class="progress-percent">${professionalRate}%</span>
        </span>
    `;
            }
        }

        // **ä¿®æ”¹ï¼šç¶²é è¼‰å…¥æ™‚çš„é‚è¼¯**
        window.addEventListener('load', function () {
            // 1. å…ˆå‹•æ…‹ç”Ÿæˆæ‰€æœ‰ç§‘ç›®å¡ç‰‡ (é€™æœƒå‰µå»ºæ‰€æœ‰çš„ checkbox)
            for (const key in subjectData) {
                createSubjectCard(key);
            }

            // 2. æ¥è‘—ï¼Œå¾ localStorage è¼‰å…¥ä¹‹å‰å„²å­˜çš„ç‹€æ…‹ï¼Œä¸¦æ‡‰ç”¨åˆ°å‰›å‰µå»ºçš„ checkbox ä¸Š
            loadSavedStates();

            // 3. æœ€å¾Œï¼Œæ ¹æ“šç•¶å‰ (å·²è¼‰å…¥æˆ–é è¨­) çš„ checkbox ç‹€æ…‹ä¾†æ›´æ–°æ‰€æœ‰é€²åº¦é¡¯ç¤º
            updateProgress();
            initTimeDisplay({
                containerId: 'timeDisplayContainer',
                style: 'default'
            });
        });
    </script>

</body>

</html>